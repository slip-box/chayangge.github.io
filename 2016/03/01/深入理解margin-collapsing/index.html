<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 深入理解margin collapsing · 插秧哥's Blog</title><meta name="description" content="深入理解margin collapsing - 插秧哥"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://chayangge.com/atom.xml" title="插秧哥's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/chayangge" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">深入理解margin collapsing</h1><div class="post-info">Mar 1, 2016</div><div class="post-content"><p>你以为margin折叠只发生在相邻元素之间？别漏掉了父子元素之间也会产生margin折叠。本篇对其产生条件及消除方法进行总结，希望对你有所帮助，欢迎指正错误和不足。<br>产生margin折叠的两种情况：</p>
<ul>
<li>相邻上下位置关系元素</li>
<li>嵌套的父子或祖先元素（本文重点）<a id="more"></a>
</li>
</ul>
<h2 id="第一种情况：相邻上下位置关系元素"><a href="#第一种情况：相邻上下位置关系元素" class="headerlink" title="第一种情况：相邻上下位置关系元素"></a>第一种情况：相邻上下位置关系元素</h2><p>首先了解一下上元素的<code>margin-bottom</code>与下面元素的<code>margin-top</code>数值的折叠规则：</p>
<blockquote>
<p>规则1. 正数、正数取最大（最常见）50px,20px –&gt; 50px<br>规则2. 一正、一负取其和（不常见）50px,-20px –&gt; 30px<br>规则3. 负数、负数 绝对值取最大（很少见） -50px,-20px –&gt; -50px</p>
</blockquote>
<p>看代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pre"</span>&gt;</span>pre<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"next"</span>&gt;</span>next<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;  <span class="comment">/*防止父元素塌陷设定了高度*/</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.pre</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#8FB2F2</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.next</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#FE9EA4</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这是最常见的折叠情况，上元素的<code>margin-bottom</code>与下面元素的<code>margin-top</code>发生了规则1的折叠，取其最大值，所以总体上下间距为<code>50px</code>,如下图所示：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-1.png" alt="50px"><br>规则2的情况各为50px,-20px时，间距为30xp，效果如下：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-3.png" alt="30px"><br>规则3的情况各为-50px,-20px时，间距为-50xp，效果如下：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-4.png" alt="-50px"></p>
<h3 id="消除折叠"><a href="#消除折叠" class="headerlink" title="消除折叠"></a>消除折叠</h3><p>在<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Box_Model/Mastering_margin_collapsing" target="_blank" rel="noopener">规范里</a>有这么一句话：</p>
<blockquote>
<p><strong>Margins of floating and absolutely positioned elements never collapse.</strong></p>
</blockquote>
<p>也就是说float元素和absolute定位的元素（都脱离了文档流，且形成了BFC）不会产生margin折叠。<br>于是我测试了下以下下代码：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pre</span>&#123;</span><br><span class="line">	<span class="attribute">float</span>:left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#8FB2F2</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.next</span>&#123;</span><br><span class="line">	<span class="attribute">float</span>:left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#FE9EA4</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时间距为总和70px，没有发生折叠：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-2.png" alt="70px"><br>同样，添加以下代码也是如此（对.pre .next两元素设定display: inline-block;）<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pre</span>,<span class="selector-class">.next</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为什么也没发生折叠？因为float后的元素效果和<code>display: inline-block;</code>效果一样，形成了新的BFC，所以也不会折叠。</p>
<h2 id="第二种情况：父子元素之间（本文重点）"><a href="#第二种情况：父子元素之间（本文重点）" class="headerlink" title="第二种情况：父子元素之间（本文重点）"></a>第二种情况：父子元素之间（本文重点）</h2><p>先看规范中的详细解释：</p>
<blockquote>
<p>If there is no border, padding, inline content, or clearance to separate the margin-top of a block from the margin-top of its first child block, or no border, padding, inline content, height, min-height, or max-height to separate the margin-bottom of a block from the margin-bottom of its last child, then those margins collapse. The collapsed margin ends up outside the parent.</p>
</blockquote>
<p>看代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"fa"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"son"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span>&#123;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;  </span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fa</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#8FB2F2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.son</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#FE9EA4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>你本想的效果是这样的：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-6.png" alt="想要"><br>可实际折叠后的效果是这样的：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-5.png" alt="实际"><br>那么问题来了，怎样禁止子父元素间的margin折叠？</p>
<h3 id="清除父子嵌套中产生的折叠的方法"><a href="#清除父子嵌套中产生的折叠的方法" class="headerlink" title="清除父子嵌套中产生的折叠的方法"></a>清除父子嵌套中产生的折叠的方法</h3><p>禁止产生折叠就应先知道产生折叠的原因：</p>
<blockquote>
<p>1.父子元素紧密相邻无其他元素 no border,no padding<br>2.同处一个BFC</p>
</blockquote>
<p>所以破坏折叠条件就自然能阻止margin折叠了<br>针对条件1可采用，增加border、padding、“文字”、伪元素 都可解决:</p>
<blockquote>
<ol>
<li>父元素加border：<code>border-top:.1px solid transparent;</code> 透明且很窄</li>
<li>添加padding：<code>padding-top: .1px;</code></li>
<li>添加加伪元素： <code>.fa:before{content: &quot;&quot;;display:inline-block;}</code></li>
<li>父元素标签中加点“文字”,不让其中间为空，如下图：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-8.png" alt="添加文字"></li>
</ol>
</blockquote>
<p>针对条件2产生新的BFC即可，方法有设置 display,float,absolute,overflow。具体为：</p>
<blockquote>
<ol start="5">
<li>设置float属性不为none</li>
<li>设置position为absolute或fixed</li>
<li>设置display为inline-block,flex, inline-flex</li>
<li>设置overflow不为visible</li>
</ol>
</blockquote>
<h3 id="子父关系中最后一个子元素下边距同样也会与父元素折叠"><a href="#子父关系中最后一个子元素下边距同样也会与父元素折叠" class="headerlink" title="子父关系中最后一个子元素下边距同样也会与父元素折叠"></a>子父关系中最后一个子元素下边距同样也会与父元素折叠</h3><p>原因和解决方法同上所述</p>
<h3 id="子父元素之间的折叠会扩展到祖元素，直到body"><a href="#子父元素之间的折叠会扩展到祖元素，直到body" class="headerlink" title="子父元素之间的折叠会扩展到祖元素，直到body"></a>子父元素之间的折叠会扩展到祖元素，直到body</h3><p>删除祖元素.wrap中的<code>display: inline-block;</code>使其不产生新的BFC，此时整个页面都会的父子元素的折叠会扩展到body上，其效果是整个body因最里面的子元素的<code>margin-top</code>而下沉：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span>&#123;</span><br><span class="line">	<span class="comment">/* 删除inlin-block */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;  </span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fa</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#8FB2F2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.son</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">90%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#FE9EA4</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-9.png" alt="效果"></p>
<h2 id="空元素也会产生margin折叠"><a href="#空元素也会产生margin折叠" class="headerlink" title="空元素也会产生margin折叠"></a>空元素也会产生margin折叠</h2><p>一个无高度、最小高度，无border,无padding，无内容的元素也会发生margin折叠：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.wrap</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;  </span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.fa</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#8FB2F2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.son</span>&#123;</span><br><span class="line">	<span class="comment">/* 上述中的三无青年 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#FE9EA4</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160301-11.png" alt="空元素"></p>
<p>关于margin折叠的问题，BFC的概念很重要，理解了它很多问题迎刃而解，多查资料，多用google，多查标准，希望对你有所帮助。</p>
<p>参考资料：<br><a href="https://www.w3.org/TR/CSS21/box.html#collapsing-margins" target="_blank" rel="noopener">https://www.w3.org/TR/CSS21/box.html#collapsing-margins</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Box_Model/Mastering_margin_collapsing" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Box_Model/Mastering_margin_collapsing</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/03/09/如果你的网页在手机上无法缩放/" class="prev">上一篇</a><a href="/2016/02/28/RequireJS入门/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2016/03/01/深入理解margin-collapsing/';
var disqus_title = '深入理解margin collapsing';
var disqus_url = 'http://chayangge.com/2016/03/01/深入理解margin-collapsing/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2021 <a href="http://chayangge.com">插秧哥</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>