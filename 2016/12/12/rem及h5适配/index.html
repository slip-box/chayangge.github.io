<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> rem及h5适配 · 插秧哥's Blog</title><meta name="description" content="rem及h5适配 - 插秧哥"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://chayangge.com/atom.xml" title="插秧哥's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/chayangge" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">rem及h5适配</h1><div class="post-info">Dec 12, 2016</div><div class="post-content"><h2 id="什么是rem？"><a href="#什么是rem？" class="headerlink" title="什么是rem？"></a>什么是rem？</h2><p>rem是css3才有的新度量单位，定义为：font size of the root element。首字母的r是root，这个根代指<code>&lt;html&gt;</code>。那em呢？关于rem和em的关系参考<a href="http://www.w3cplus.com/css/rem-vs-em.html" target="_blank" rel="noopener">这篇文章</a>。<br><a id="more"></a><br>px是固定尺寸，rem是相对尺寸，rem的值与<code>&lt;html&gt;</code>字体px大小成倍数关系，比如：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>&#123;</span><br><span class="line">	<span class="attribute">font-size</span>:<span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span>&#123;</span><br><span class="line">	font-size:2rem;  // 2*10 = 20px</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那么html默认字体是多少呢？——16px。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>&#123;</span><br><span class="line">	<span class="attribute">font-size</span>:<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span>&#123;</span><br><span class="line">	font-size:1rem; // 16px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但我们的设计稿的距离都是px，当用rem为单位时总要这么一步计算：设计稿尺寸/16 = 想要的rem。但16这个数不好除，所以经常会看到这样定义html的fontsize：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>&#123;</span><br><span class="line">	<span class="attribute">font-size</span>: <span class="number">62.5%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span>&#123;</span><br><span class="line">	font-size: 2rem; // 20px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>62.5哪里来？答案是10/16 = 0.625。这里相当于把html的font-size定位10px，只要把设计稿的尺寸往左移动一个小数点即可得到rem值，方便了很多。</p>
<p>rem的使用技巧就这些。</p>
<h2 id="计算viewport"><a href="#计算viewport" class="headerlink" title="计算viewport"></a>计算viewport</h2><p>常见的viewport长这样：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,user-scalable=0"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重点是initial-scale的值，scale由window.devicePixelRatio计算而来：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale = <span class="number">1</span>/<span class="built_in">window</span>.devicePixelRatio</span><br></pre></td></tr></table></figure></p>
<h3 id="window-devicePixelRatio-是什么？"><a href="#window-devicePixelRatio-是什么？" class="headerlink" title="window.devicePixelRatio 是什么？"></a>window.devicePixelRatio 是什么？</h3><p>window.devicePixelRatio是设备像素比，也就是设备的物理像素（屏幕上的点状小颗粒）与设备独立像素（计算机系统屏幕坐标位置点）的比值。其中iphone5、6都为2，plus为3，其他安卓也大不相同。</p>
<h2 id="h5适配方案"><a href="#h5适配方案" class="headerlink" title="h5适配方案"></a>h5适配方案</h2><p>首先根据不同的devicePixelRatio计算出scale，重写进meta标签中。</p>
<p>然后，既然控制根节点html的font-size就能控制整个页面，那么针对不同尺寸的h5浏览器，就可以根据各自尺寸来调节页面了，html的font-size肯定不能写死，需要根据js检测屏幕尺寸后动态计算，这就是适配工具的原理。核心代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dpr = <span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span>,</span><br><span class="line">scale = <span class="number">1</span> / dpr,</span><br><span class="line">content = <span class="string">'width=device-width, initial-scale='</span> + scale + <span class="string">', minimum-scale='</span> + scale + <span class="string">', maximum-scale='</span> + scale + <span class="string">', user-scalable=no'</span>;</span><br><span class="line"></span><br><span class="line">metaEle.setAttribute(<span class="string">"content"</span>, content); </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> width = <span class="built_in">document</span>.documentElement.getBoundingClientRect().width || <span class="built_in">window</span>.innerWidth;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.documentElement.style.fontSize = width / <span class="number">16</span> + <span class="string">"px"</span>; <span class="comment">// 默认16，除以10也行，方便计算</span></span><br></pre></td></tr></table></figure></p>
<h2 id="其他细节"><a href="#其他细节" class="headerlink" title="其他细节"></a>其他细节</h2><p>除此之外，还要注意一些细节，比如字体，既然css统一用了rem，html根字体是后续js修改的，并不能影响body中的字体，虽然字体默认是继承自父元素，这里的父元素并不是html而是body，所以也要js手动设定body的字体为：devicePixelRatio*12</p>
<p>注意一个bug：当页面背景为整个一张图片时，触发输入键盘后，键盘会从底部弹出，占用屏幕很大一块空间，正常情况下是网页整体也随之上升，但在很多安卓浏览器下并不是这样，文本框上升到可输入位置，但背景并没有被键盘推上去，而是在上面残余的空间内『挤压』的很窄。针对这一现象，在js中计算出屏幕高度后，用次高度写死body的高度即可。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/12/16/制作自己的IconFont/" class="prev">上一篇</a><a href="/2016/12/04/2016-12-04 酒局/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2016/12/12/rem及h5适配/';
var disqus_title = 'rem及h5适配';
var disqus_url = 'http://chayangge.com/2016/12/12/rem及h5适配/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2021 <a href="http://chayangge.com">插秧哥</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>