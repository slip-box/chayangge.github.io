<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> javascript中replace()详解 · 插秧哥's Blog</title><meta name="description" content="javascript中replace()详解 - 插秧哥"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://chayangge.com/atom.xml" title="插秧哥's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/chayangge" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">javascript中replace()详解</h1><div class="post-info">Jan 24, 2016</div><div class="post-content"><p>功能强大的replace()是开发中的利器，往往一段复杂的逻辑代码只需一个replace就能搞定。但掌握好它也挺不容易，因为我们不仅要了解它的基本用法、参数，还要掌握正则、算法等技能，综合起来才能让它的功力发挥的淋淋尽致，以下是我在开发中遇到的用法，留作总结。<br>首先介绍一下replace()的基本用法：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string.replace(regexp, replacement或函数)</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>第一个参数可以为一个字符串，也可以十一个强大灵活的正则，正则怎么写这里不做重点介绍。需要注意的是第二个参数，该参数既可以是个字符串也可以是个函数，形形色色的替换规则就是靠第二个参数来实现的，尤其是字符串中夹杂的$,非常有意思：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160215-3.png" alt="$的不同含义（图片来自犀牛书）"></p>
<p>当第二个参数为函数时，每个匹配项都调用该函数，该函数返回的字符串作为替换文本。想到了<code>sort(compare)</code>?<br><strong>重点是该函数的参数不是固定的且至少有4个！</strong>不同的参数又代表不同含义,下面是四个参数时的情况，匹配[]中的两个汉字：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"这是[第一]用来[第二]测试的[第三]文本！"</span>;</span><br><span class="line"><span class="keyword">var</span> newStr = str.replace(<span class="regexp">/\[([\u4e00-\u9fa5]&#123;2&#125;)\]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c, d</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);  </span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    <span class="built_in">console</span>.log(c);</span><br><span class="line">    <span class="built_in">console</span>.log(d); <span class="comment">//如果继续打印e,f,g...多出的参数会undefined</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>第一个参数a代表匹配项： [第一]<br>第二个参数b代表匹配项的组匹配：  第一 （注意：只有一个组匹配，它决定了参数的个数）<br>第三个参数c代表匹配到的内容在字符串中的位置：  2<br>第四个参数d代表整个字符串：  这是[第一]用来[第二]测试的[第三]文本！</p>
<p>由于每个匹配项都执行该函数，则以上代码运行结果为：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160215-4.png" alt="运行结果"></p>
<p>下面是4个以上参数的情况，也就是有多个组匹配的情况,匹配[]中的所有的两个汉字，此时参数为5个：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"这是用来[两对汉字]测试的文本！"</span>;</span><br><span class="line"><span class="keyword">var</span> newStr = str.replace(<span class="regexp">/\[([\u4e00-\u9fa5]&#123;2&#125;)([\u4e00-\u9fa5]&#123;2&#125;)\]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c, d,e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);   <span class="comment">// [两对汉字]</span></span><br><span class="line">    <span class="built_in">console</span>.log(b);   <span class="comment">// 两对</span></span><br><span class="line">    <span class="built_in">console</span>.log(c);   <span class="comment">// 汉字</span></span><br><span class="line">    <span class="built_in">console</span>.log(d);   <span class="comment">// 4</span></span><br><span class="line">    <span class="built_in">console</span>.log(e);   <span class="comment">// 这是用来[两对汉字]测试的文本！</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>以上代码运行结果为：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160215-6.png" alt="运行结果"><br>以此类推，函数的倒数第一个参数始终是整个文本，倒数第二个始终表示位置，第一个参数始终表示匹配项，重点是从第二个参数开始，组匹配的个数决定了函数参数的个数。</p>
<p>好了，难点就这些，下面是我用到的小例子，供大家参考，有不足或优化建议还请多多指教：</p>
<h2 id="1-加密手机号码"><a href="#1-加密手机号码" class="headerlink" title="1.加密手机号码"></a>1.加密手机号码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> phoneNum = <span class="string">"18842961561"</span></span><br><span class="line">phoneNum.replace(<span class="regexp">/([1-9]&#123;3&#125;)\d&#123;4&#125;(\d&#123;4&#125;)/</span>,<span class="string">"$1****$2"</span>);</span><br><span class="line"><span class="comment">// 188****1561</span></span><br></pre></td></tr></table></figure>
<h2 id="2-去空格"><a href="#2-去空格" class="headerlink" title="2. 去空格"></a>2. 去空格</h2><p>去空格是最常见的使用方法了，去空格包括去除所有空格，去除首尾空格，很多js类库都用它实现了trim方法:</p>
<h3 id="去除首尾空格"><a href="#去除首尾空格" class="headerlink" title="去除首尾空格"></a>去除首尾空格</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"   abc def jh  "</span></span><br><span class="line">str.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">""</span>); <span class="comment">//去首尾空格。去所有空格：/\s/g</span></span><br><span class="line"><span class="string">"abc def jh"</span></span><br></pre></td></tr></table></figure>
<p>比如mootools的源码：<br><img src="http://7xprui.com1.z0.glb.clouddn.com/blogQQ20160215-5.png" alt="mootools源码"></p>
<h2 id="3-匹配聊天表情"><a href="#3-匹配聊天表情" class="headerlink" title="3.匹配聊天表情"></a>3.匹配聊天表情</h2><p>在网络聊天中经常要插入表情，如： 早点休息[晚安]拜拜，要匹配出晚安二字并替换为晚安的表情，那么具体实现方法如下：<br>先建立一个对象，保存表情名与对应的表情图片链接地址，然后匹配表情名，如果对象里有该表情名则替换出相应的图片地址：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> json = &#123; <span class="comment">// 表情  链接 存储对象</span></span><br><span class="line">        <span class="string">"抽搐"</span>: <span class="string">"./img/expression/01.gif"</span>,</span><br><span class="line">        <span class="string">"大哭"</span>: <span class="string">"./img/expression/01.gif"</span>,</span><br><span class="line">        <span class="string">"点头"</span>: <span class="string">"./img/expression/03.gif"</span>,</span><br><span class="line">        <span class="string">"调皮"</span>: <span class="string">"./img/expression/04.gif"</span>,</span><br><span class="line">        <span class="string">"奋斗"</span>: <span class="string">"./img/expression/05.gif"</span>,</span><br><span class="line">        <span class="string">"害怕"</span>: <span class="string">"./img/expression/06.gif"</span>,</span><br><span class="line">        <span class="string">"好冷"</span>: <span class="string">"./img/expression/07.gif"</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> content = <span class="string">"好感动[大哭]太感人了！"</span>;</span><br><span class="line"><span class="keyword">var</span> newContent = content.replace(<span class="regexp">/\[([\u4e00-\u9fa5]&#123;2&#125;)\]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a); <span class="comment">// [大哭]</span></span><br><span class="line">    <span class="built_in">console</span>.log(b); <span class="comment">//大哭</span></span><br><span class="line">    <span class="keyword">if</span>(json[b])&#123; </span><br><span class="line">      <span class="keyword">return</span> <span class="string">"&lt;img src='"</span> + json[b] + <span class="string">"' /&gt;"</span>   <span class="comment">//&lt;img src='./img/expression/01.gif' /&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="添加千位符"><a href="#添加千位符" class="headerlink" title="添加千位符"></a>添加千位符</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addComma</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (num+<span class="string">""</span>).replace(<span class="regexp">/(\d)(?=(\d\d\d)+(?!\d))/g</span>, <span class="string">"$1,"</span>);</span><br><span class="line">&#125;</span><br><span class="line">addComma(<span class="number">10086</span>) <span class="comment">// 10,086</span></span><br><span class="line">addComma(<span class="number">-10086</span>) <span class="comment">// -10,086</span></span><br><span class="line">addComma(<span class="number">1008.6</span>) <span class="comment">// 1,008.6</span></span><br><span class="line">addComma(<span class="number">-100000.90989</span>); <span class="comment">// -100,000.90,989</span></span><br></pre></td></tr></table></figure>
<p>就这些，日后再加。</p>
<h2 id="添加千位符-1"><a href="#添加千位符-1" class="headerlink" title="添加千位符"></a>添加千位符</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addComma</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (num+<span class="string">""</span>).replace(<span class="regexp">/(\d)(?=(\d\d\d)+(?!\d))/g</span>, <span class="string">"$1,"</span>); </span><br><span class="line">&#125;</span><br><span class="line">addComma(<span class="number">10086</span>) <span class="comment">// 10,086</span></span><br><span class="line">addComma(<span class="number">-10086</span>) <span class="comment">// -10,086</span></span><br><span class="line">addComma(<span class="number">1008.6</span>) <span class="comment">// 1,008.6</span></span><br><span class="line">addComma(<span class="number">-100000.90989</span>); <span class="comment">// -100,000.90,989</span></span><br></pre></td></tr></table></figure>
<h2 id="裁剪数字"><a href="#裁剪数字" class="headerlink" title="裁剪数字"></a>裁剪数字</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cutNumber</span> (<span class="params">value,len</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = value.toString();</span><br><span class="line">    <span class="keyword">return</span> str.length &lt;= len ? str :str.substr(<span class="number">0</span>,len) + <span class="string">'…'</span>;</span><br><span class="line">&#125;</span><br><span class="line">cutNumber(<span class="number">1000000</span>,<span class="number">4</span>);  <span class="comment">//1000...</span></span><br></pre></td></tr></table></figure>
<h2 id="匹配中文姓名"><a href="#匹配中文姓名" class="headerlink" title="匹配中文姓名"></a>匹配中文姓名</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^([\u4e00-\u9fa5]&#123;2,8&#125;)$/</span></span><br><span class="line"><span class="keyword">if</span> (reg.test(<span class="string">"峰谁说的峰谁说的是"</span>)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"yes"</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"no"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考资料：<br>《javascript权威指南》<br><a href="http://javascript.ruanyifeng.com/stdlib/regexp.html#toc8" target="_blank" rel="noopener">《javascript标准参考教程》</a></p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2016/02/23/我司前端技术概括-水文/" class="prev">PREV</a><a href="/2016/01/18/text-align-justify最后一行有个坑/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'seansun';
var disqus_identifier = '2016/01/24/有关String-prototype-replace-的总结/';
var disqus_title = 'javascript中replace()详解';
var disqus_url = 'http://chayangge.com/2016/01/24/有关String-prototype-replace-的总结/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2019 <a href="http://chayangge.com">插秧哥</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>